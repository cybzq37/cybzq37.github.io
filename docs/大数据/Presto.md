Presto相关的论文中提到了一些概念，其中比较重要的几个如下：  
数据源连接器(Connector)：如果想让Presto能够从某个存储系统、消息队列、文件拉取、API进行数据并发查询，需要实现对应的连接器。基本上任何可以提供数据的数据源都可以通过连接器的抽象接入Presto。  
数据目录(Catalog)：数据目录是一个逻辑概念。在Presto中定义数据目录时，需要为其指定一种数据源连接器，并通过相关的配置指定如何连接上对应的数据源。数据目录与数据源连接器是多对一的关系。  
数据库(Schema)：这个概念可以等同于传统关系型数据库的中的数据库的概念。一个数据目录可以包含多个数据库。  
数据表(Table)：这个概念可以等同于传统关系型数据库中的数据表的概念。一个数据库可以包含多个数据表。  

在Presto的架构中有两种节点：
集群协调节点(Coordinator)，负责接收SQL查询请求、解析SQL、生成和优化执行计划、生成和调度任务(Task)到查询执行节点上。集群协调节点将一个完整的查询拆分成多个查询执行阶段(Stage)，每个阶段拆分出多个可以并行的任务。  
集群执行节点(Worker)，负责执行集群协调节点发给它的任务，有部分任务负责到外部存储系统拉取数据，这部分任务会先执行，之后再执行那些负责计算的任务。从图1-7中可以看到，拉取数据的任务是在右侧两个集群执行节点上执行的，负责计算的任务是在左侧一个集群执行节点上执行的。  

### ODS（Operational Data Store，操作数据存储）
- 定义：ODS 是一个用于存储来自多个操作系统的数据的数据库，通常用于支持日常操作和决策。
- 特点：
- 数据通常是实时或近实时的，反映当前的业务状态。
- 主要用于数据整合，提供一个统一的视图，便于后续分析。
- 数据结构相对简单，通常不进行复杂的转换和清洗。

### DW（Data Warehouse，数据仓库）
- 定义：DW 是一个用于存储历史数据的系统，专门设计用于支持分析和报告。
- 特点：
- 数据通常是经过清洗、转换和整合的，适合进行复杂的查询和分析。
- DW 通常采用星型或雪花型模型，支持多维分析。
- 数据更新频率较低，通常是批量加载（如每日、每周）。

### DM（Data Mart，数据集市）
- 定义：DM 是一个针对特定业务线或部门的数据仓库子集，通常用于满足特定的分析需求。
- 特点：
- 数据量相对较小，专注于特定主题（如销售、财务等）。
- 可以从 DW 中提取数据，也可以直接从 ODS 中获取。
- 设计上更灵活，便于快速响应特定业务需求。

![[assets/Pasted image 20250515213107.png]]

现在整个OLAP领域的设计实现，还是基于20年前的VLDB、SIGMOID的基础理论。

使用Spark Streaming或Flink Streaming将数据写入Hive；只用Hive Metastore存储库、表、字段这些元数据，不使用Hive MapReduce做查询；对于有低延迟要求的查询使用Presto作为计算引擎，延迟要求不高的查询使用Spark SQL作为离线计算引擎，部分公司还利用Alluxio做HDFS cache来加快Presto查询速度。

常见的数仓数据模型有两种：即Inmon的关系数据模型与Kimball的维度数据模型。关系数据模型强调数据模型设计者对企业的业务有较为全面的认知，能够站在全局的角度设计出遵循范式的数据模型。维度数据模型强调将业务过程映射为维度与事实，并分为维度表与事实表，不要求对企业业务有整体认识，追求快速迭代数据模型。下面对上面涉及的几个关键术语进行解读。  

数据模型：
业务过程：企业开展业务时发生的业务流程，如电商领域中的下单、支付、送货、确认收货等。
维度：维度表达的是业务过程的上下文环境信息，如下单时间、下单APP、用户ID等。维度表中存储的是维度信息，并且会存在多个维度表，如用户维度信息表（包含用户ID、用户昵称、用户年龄等）​、商品维度信息表（包含商品ID、商品名称、商品其他属性等）​。
事实：事实表达的是业务过程中的具体度量，如购买数量、订单金额等。事实表中存储的是各个维度ID以及各个事实的度量值。

TPC-DS Data Model数据模型介绍
TPC-DS Data Model采用的是业界常用的Kimball维度建模方式。本节会对其简要介绍。对这部分感兴趣的读者，请参考《数据仓库工具箱》和《阿里巴巴大数据之路》​。

元数据与分布式协调模块中涉及的节点服务发现、选主、元数据存储这些需求，要么依赖外部组件（如Zookeeper或企业内其他类似组件）​，要么借助分布式一致性协议（如Paxos、Raft）自研实现。


它的查询执行过程可以拆解为以下几个步骤。
第一步：接收SQL查询请求。
第二步：进行词法与语法分析（生成AST）​。
第三步：创建和启动QueryExecution。第四步：进行语义分析(Analysis)，生成初始执行计划。
第五步：优化执行计划，生成优化后的执行计划。
第六步：将逻辑执行计划树拆分为多棵子树（查询执行阶段）​。
第七步：创建SqlStageExecution（查询执行阶段）​。
第八步：在查询执行阶段调度HttpRemoteTask并分发到Presto查询执行节点。
第九步：在多个Presto查询执行节点上执行任务并产出查询结果。
第十步：分批返回查询计算结果并返给SQL客户端。


![[assets/Pasted image 20250520234118.png]]